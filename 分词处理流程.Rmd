---
title: "jiebaR"
author: "xyr"
date: "2017妤<a0><9e><b4>3闁<ba><88><88>11闁<ba><83><a5>"
output:
  html_document: default
  pdf_document: default
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:



医生访谈记录的分词处理


#查看词库的位置
```{r}
show_dictpath()
```
#查看目录
```{r}
dir(show_dictpath())
```
#5分钟上手
```{r}
wk=worker()
wk["我是R的极客理想的图书作者"]
```
#使用其他的方法
```{r}
wk<='另一种分词方法'
segment("segment()函数的写法",wk)
```
#运行分词程序，会在当前目录生成一个新的分词结果的文件
```{r}
wk['./fenci/doctor.txt']
```
#使用自定义的用户词典，对刚才的文本再进行分词
```{r}
wk=worker(user = 'user.dict.utf8')
wk['./fenci/doctor.txt']
```

#转换二进制词典到文本文件
#转换
```{r}
decode_scel(scel = "./14108.scel",cpp = TRUE)
```

#查看生词的词典文件
```{r}
scan(file = "./14108.scel_2017-03-11_00_47_25.dict",what=character(),
     nlines = 50,sep = '\n',encoding = 'utf-8',fileEncoding = 'utf-8')

```


#停止词过滤
#一种是通过配置stop_word文件，另一种是使用filter_segment()函数
#新建一个stop_word.txt文件

~notepad stop_word.txt
我
我是

加载分词引擎，并配置停止词过滤
```{r}
wk=worker(stop_word = 'stop_word.txt')
segment=wk["我是中山大学的水货研究生"]
segment
```
????为什么失败了

#第二种，通过动态的调用filter_segment()函数
```{r}
filter=c("水货")
filter_segment(segment,filter)
```

#关键词提取
利用TF-IDF算法，计算TF-IDF的公式为
TF-IDF=TF(词频)*逆文档频率（IDF）
jiebaR的关键词提取的实现，也是使用了TF-IDF的算法。在安装目录中的idf-utf8文件，为IDF的语料库。查看idf.utf8内容
```{r}
scan(file = "C:/Users/Nucky/Documents/R/win-library/3.3/jiebaRD/dict/idf.utf8",what = character(),nlines = 50,sep = "\n",encoding = 'utf8',fileEncoding = 'utf-8')

```

#对下面的文本提取关键词
```{r}
wk=worker()
segment=wk["30 例 半天 限 号 外地 的 占多数 不 了解 比例 大部分 城职 抗病毒 治疗 70 其中 恩替卡韦 70 会 主动 向 满足条件 的 患者 普及 门特会 明确 跟 病人 说明 费用 让 病人 自己 选择 负担 的 起 的 用药 对于 这个 政策 较为 满意 认为 政策 已 覆盖 大部分 患者 认为 乙肝 治疗 的 费用 大约 1000 元 以内 额度 上 算是 报销 挺 多 的 依从性 的 问题 需要 病人 自己 对 健康 的 认知 和 考虑 30 例 半天 限 号 医保 患者 约 占 50 60 大部分 为 城镇职工 80 采用 抗病毒 治疗 其中 70 患者 使用 恩替卡韦 副作用 小 会 主动 向 满足条件 的 患者 普及 门特 对 有 医保 的 患者 大大 减轻 了 负担 拥有 广州 门特 的 医保 比较 会 遵循 治疗 医生 希望 门特 报销 的 人群 范围 仅 包括 了 广州 深圳 或 异地 的 病人 无法 报销 一个月 拿 一次 药是 可以 接受 的 30 40 例 半天 其中 乙肝患者 占 90 医保 患者 约 占 50 绝大 大部分 为 城镇职工 医保 居民 医保 包括 农村 城中村 居民 一般 去 社区 看病 或者 想 办法 变成 城镇职工 医保 门诊病人 大多 病情 稳定 多数 使用 抗病毒 治疗 用药 因人而异 恩替卡韦 和 替比夫定 较 多 会 主动 向 满足条件 的 患者 普及 门特 门特 政策 还 可以 基本上 满足 了 用药 的 需求 就 像 国产 恩替卡韦 门特 报销 80 患者 每月 只 需 自费 120 元 慢 乙肝 费用 已 算不上 经济负担 了 1. 希望 替诺福韦 可以 进 医保 目录 2. 病毒 定量 检测 还 未 在 医保 报销 部分 中 3. 单 病种 用 药物 适应症 限制 如 甘草酸 制剂 必须 要 归类 为 肝 衰竭 才能 开 特指 非 广州 深圳 等 城市 的 广东 其他 城市 某 药 患者 只要 有 黄疸 就 得 用 但 只能 肝硬化 才能 开 虽然 医保 基础 药品 目录 很大 但 因为 单 病种 限制 较易 引起 医患 矛盾 4. 医保 目录 中 药物 应 扩大范围 应多 听 临床 医生 的 建议 推荐 30 40 例 半天 今天 早上 看 了 34 个 患者 其中 有 30 个 乙肝患者 其余 为 1 个 丙肝 2 个 脂肪肝 1 个 肺癌 相关 患者 30 个 乙肝患者 中有 11 个 广州 医保 患者 大部分 为 城镇职工 今天 看病 11 个 医保 患者 全为 城职 多数 病人 病情 稳定 门诊病人 几乎 都 是 来 拿药 的 大多 使用 抗病毒 治疗 何种 抗病毒 药物 要 看 病情 根据 自身 轻重 护肝药 抗 纤维化 药物 等 会 主动 向 满足条件 的 患者 普及 门特 除去 重症 住院病人 门诊病人 大部分 能 负担 的 起 1. 门特 目录 中 的 药物 应 及时 更新 如 替诺福韦 药物 还 未进 医保 2. 对 医疗 投入 应需 加大 投入 力度 提高 报销 额度 造福 病人"]

#过滤掉一些词

filter=c("医保","患者","门特")
filter_segment(segment,filter)


freq(segment)

```

#提取TF-IDF的前5关键词
```{r}
keys=worker("keywords",topn = 10)

#计算关键词
vector_keywords(segment,keys)


```

#通过上面的结果制作成词云可视化
```{r}
library(wordcloud2)
cysegment=freq(segment)
wordcloud2(cysegment,color = "random-light",backgroundColor="grey")

```

患者访谈记录的分词处理

```{r}
library(jiebaR)
wk=worker()
segment=wk["十多年病史，如今恢复良好，已停止用药。男性；城镇职工之前服用拉米夫定，阿德福韦酯，中成药等，约两年前使用干扰素针剂，初期一个星期一针，后期一个月一针至停止用药，半年复查一次。900元一针，共24针，医疗费用对生活有一定压力，但有商业保险和门特医保，缓解了许多经济压力。医生口述总体满意，希望能提高门特额度，加大力度，建议开发医保相关APP提高报销效率。距离近，很方便十多年（携带）一年多前发病，今年城职；男性服用恩替卡韦药费（700/月，其中自费100/月）；3/6个月复查一次，一年费用约3000；患者表示经济压力不大医院的宣传单1、	一个月拿药比较麻烦，希望能结合复查（1次/3个月）然后三个月拿一次药。2、	报销的排队时间长，希望报销时间能够减短3、	该患者没有申请门慢交通生活的影响不大，定点医院就医还算方便先天一床发病，上星期刚申请门特城职，收入7000/月；女性服用替比夫定+复方甘草酸苷；之前服用过阿德福韦酯，之前一直自费购买药品。药费（1000/月，自费100），如果肝功能有问题，医生会多开降转氨酶的药（3/400元每月）；3个月复查一次（300元），医保报销900元；总体经济压力不大，一年总的医疗费用约2500元。诊室门口海报；医生推广一个月拿药比较麻烦（经常需要请假上医院拿药），希望能结合复查（1次/3个月）然后三个月拿一次药。定点医院离家里近，交通比较方便十多年；一年多前申请门特城职，收入：退休金（2200/月）；女性服用恩替卡韦（刚开始有免费试用5年），以前服用拉米夫定药费（1000/月，自费300）；复查（300/3个月）；收入低，经济压力较大关注新闻，了解这项疾病的情况和门特政策的具体情况1、	申请过门慢，相比，门慢报销额度太小。门特的报销额度不够（恩替卡韦1000/月，同时还有其他疾病（感冒）负担就比较大；希望提高额度。报销的时候，排队时间长，处理报销的速度太慢由于长期服药多年（本患者需要快递给天津打工的老伴），所以一个月拿药后寄快递比较麻烦，希望能3个月或者2个月拿一次药都可以续期希望能提前，需要医生签字定点医院较远，地铁需要40分钟；但还是比较相信大医院。10年，无并发症男性；城职；收入10万-11万/年以前服用拉米夫定，现在服用阿德福韦酯药费（682/月，自费130）；化验费（200/次，3次/年），总体医疗费用（2000多/年），报销额度还可以，经济压力不大医生的推广门慢的额度比较低，但是药品比较优惠，报销的范围也比较大。离家比较远，但是定点医院比较好。18年，伴有高血压城职，收入（退休金3100/月）；女性恩替卡韦+护肝药药费（恩替卡韦1060元（31粒）+护肝药276元，总体报销额度用完还需要自费1000元，其中包括了高血压的用药，医疗费用的压力大医生推广门慢额度低，但好过没有；门特额度加大了，但是还是不能覆盖所有，希望能从600上升到800存在慢性病，希望能有较多补贴，能通过打款到卡里，自己安排买药，而不是按比例扣费。（按比例扣费，需要费用达到一定程度才能报销完，自己需要自费的额度也随着增大）医院大有保证，从其他医院转诊比较麻烦。小医院的门诊只会开3天药。大医院能开一个月。3年前发病城职，收入（5000-6000）；男性恩替卡韦药费（800多/月，自费100多/月），复查3个月一次，一次400元医生推广，之前一直自费，没有申请门慢希望能扩大报销区域的范围，由于工作调去珠海，希望能继续有门特政策（如一卡通）就医交通方便二十多年女性；城镇职工；月收入5000~6000元恩替卡韦（28粒/月"]
segment2=wk["）药费（700/月，其中自费120/月）；3个月复查一次，一年费用约3000元；患者表示经济无压力。医院宣传满意方便十多年病史，几个月前因劳累住院，吃药断断续续。女性；城镇职工；月收入三千多恩替卡韦（天丁）药费（700/月，其中自费118/月）； 住院复查600元/半年；经济上稍有压力。医生认为一个月拿一次药的制度太过死板（怕主治医生出差，请假，或者本人上班，无时间缓冲）还行2008年发现，半年后选择治疗，2016年12月注射干扰素。男性 学生（门特420的额度），无收入以前：替比夫定  现在：注射干扰素，一星期一针，48周一疗程，现已注射了十一针。治疗费（1200/针/星期，报销420/月）；复查费共4800/年，预计花费五万七千元。因家里经济支持，对经济压力已有心理准备。校医院介绍学生门特享受420/月，但在校学生无法享受普通门诊报销政策，希望能给予改进学校附近，故方便20多年病史男性，有糖尿病，城镇职工，收入10000/月服用恩替卡韦自费354元/月，复查3个月一次，经济压力尚可。医生推广续期麻烦，一年时间短；报销比较方便；希望额度能提高些。还行17年病史女性 城镇职工 3000/月加上其他资金来源替比夫定药费（自费130/月+报销460/月），复查3000/年，总费用4560元/年。自身通过副业减少经济压力。医生检查费贵，希望检查费能报销一部分。方便，就诊时间与主治医生的出诊时间相关，自行调整就诊时间，不用请假。八年病史男性；城镇职工；十万/年现在服用替比夫定；以前替比夫定和阿德福韦酯两者都用。药费（现在700/月，自费300/月；以前约1000/月，自费350/月），复查2000元/年；年医疗费用5600/年左右。经济负担合理。医生无门慢申请，认为门特额度合理，希望门特报销额度能够有浮动比例（如500~800），使得经济负担大的患者减轻疾病负担。方便十年病史，2010年开始治疗男性；城职职工；收入不愿透露恩替卡韦药费（一千多左右；自费300~400元/月），检查费500~600/月，总花费占收入的5%左右。医生费用压力不大，但报销拿药手续流程繁琐，一个月拿一次药需请假，耽误工作。十多分钟路程，较方便7年多病史女性；学生；居民保险；收入1000/月。	原先使用护肝药（垂盆草颗粒）强肝药（复方甘草酸苷片），现在服用替比夫定。药费（自费200/月；报销420/月），检查费（校医院检查自费20多/月）医生助理，校医院以前不知晓门慢，本身是学生，家里没帮忙，自己压力大，希望额度高。方便2009年发现，2014年选择治疗，病情稳定男性；学生；生活费1300/月左右	服用恩替卡韦药费加上复查费平均一个月自费600~700元医院海报公告得知希望药价能降下来；药物报销不足420元，希望剩余可报销金额能够累积。方便21年病史，2012年开始治疗男性；城镇职工；月收入2200/月	ETW替比夫定药费（自费200~300/月），复查费1000多，一年医疗总花费3000多。因有社保140/月故压力较少。医生，2015年1月8号加入门特对门特政策很满意，希望额度还能提高较远20多年病史，2010年开始治疗男性；城镇职工；年薪20万	恩替卡韦去年年底加入申请医保门特，自费12000/年。因家中患病人口多，经济压力大，负担大。医生一个月拿药一次改为两到三个月一次更为方便较远十年以上病史，无并发症男性；城镇职工；年收入十几万	恩替卡韦（29粒/月）药费（自费400/月左右），总医疗花费1~2万。经济压力还行。医生门特较门慢已经进步了很多，但一年一续期手续较麻烦。还行40多年病史，2、3年前选择治疗，病情稳定男性；城镇职工；退休金4000多/月	恩替卡韦药费（包括报销总花费1020元/月），一年总医疗自费3000~4000元，占生活费用的10%。医生无建议，非常满意方便十几年病史男性；城镇；年薪二十万以上	替比夫定（一天一粒）加上阿德福韦酯（一天一粒总治疗自费5000~6000/年，经济无压力。医生告知，2016年加入门特，以前申请过门慢。对门特政策满意，该患者表示：除了一季度或半年的复查需要找主治医生之外，一个月一次的拿药可以去社区或者网上解决，不需要跑到定点医院来等候。方便
"]
freq(segment)

#提取关键词
keys=worker("keywords",topn = 10)

#计算关键词
vector_keywords(segment,keys)

#制作成词云
library(wordcloud2)
cysegment2=freq(segment)
wordcloud2(cysegment2,color = "random-light",backgroundColor="grey")


```



```{r}
fenci1[is.na(fenci1)]=0
 fenci1=mutate(fenci1,freq=freq.x+freq.y)
 myvars=names(fenci1) %in% c("freq.x","freq.y")
 fenci2=fenci1[!myvars]
 View(fenci2)
 wordcloud2(fenci2,color = "random-light",backgroundColor = "grey")
 library(wordcloud2)
 cysegment=freq(segment)
 wordcloud2(cysegment,color = "random-light",backgroundColor="grey")

```




